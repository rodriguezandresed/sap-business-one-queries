SELECT TOTALES.CATEGORIA as "Categoria de Cliente", SUM(TOTALES.CLIENTES) as "Clientes", SUM(TOTALES.ACTIVACION) as  "Activados", ((CONVERT(float,SUM(TOTALES.ACTIVACION))) / CONVERT(float,SUM(TOTALES.CLIENTES)))*100 AS "% de Activacion"  FROM (SELECT  TOTALACTIVO.CATEGORIA as "CATEGORIA", sum(TOTALCLIENTE.CLIENTES) as "CLIENTES" , sum(TOTALACTIVO.ACTIVACION) as  "ACTIVACION"   FROM 


(SELECT TOTAL.RUTA, TOTAL.CATEGORIA, COUNT(TOTAL.CLIENTE) as "ACTIVACION" FROM
(SELECT 
CASE 
WHEN QUOTE.RUTA  IS NULL  THEN INVOICE.RUTA
ELSE QUOTE.RUTA
END AS 'RUTA',
CASE 
WHEN QUOTE.NOMBRE  IS NULL  THEN INVOICE.NOMBRE
ELSE QUOTE.NOMBRE
END AS 'CLIENTE',
 CASE 
WHEN QUOTE.CATEGORIA IS NULL THEN INVOICE.CATEGORIA
ELSE QUOTE.CATEGORIA
END AS 'CATEGORIA'
FROM 
(SELECT DISTINCT T0.[U_ORN_RUTAS_VENTAS] AS "RUTA", T0.[CardName]'NOMBRE', 
 CASE 
WHEN T1.[GroupCode]=100 THEN 'CADENA SUPERMERCADO'
WHEN T1.[GroupCode]=101 THEN 'MATERIA PRIMA'
WHEN T1.[GroupCode]=102 THEN 'PTES PIEZAS Y REPUES'
WHEN T1.[GroupCode]=103 THEN 'SERVICIOS'
WHEN T1.[GroupCode]=104 THEN 'SERVICIOS PERSONAL'
WHEN T1.[GroupCode]=105 THEN 'SERVICIOS/PIEZAS/REP'
WHEN T1.[GroupCode]=106 THEN 'DISTRIBUIDOR'
WHEN T1.[GroupCode]=107 THEN 'INSTITUCIONAL'
WHEN T1.[GroupCode]=108 THEN 'MAYORISTA'
WHEN T1.[GroupCode]=109 THEN 'RESTAURANT'
WHEN T1.[GroupCode]=110 THEN 'SUPERMERCADO INDEPENDIENTE'
WHEN T1.[GroupCode]=111 THEN 'EMPLEADOS'
WHEN T1.[GroupCode]=112 THEN 'ACCIONISTA'
WHEN T1.[GroupCode]=113 THEN 'ESPECIAL'
WHEN T1.[GroupCode]=114 THEN 'COMIDA/VIVERES'
WHEN T1.[GroupCode]=115 THEN 'ARTICULOS DE OFICINA'
WHEN T1.[GroupCode]=116 THEN 'TRANSPORTE'
END AS 'CATEGORIA'
FROM OQUT T0  INNER JOIN OCRD T1 ON T0.[CardCode] = T1.[CardCode] INNER JOIN QUT1 T2 ON T0.[DocEntry] = T2.[DocEntry] WHERE (T0.[DocDate] BETWEEN [%0] AND [%1]) AND (T0."CANCELED" = 'N') AND (T0."DocStatus" = 'O' ) AND T2.[Quantity] > 0  GROUP BY T0.[CardName], T1.[GroupCode], T0.[U_ORN_RUTAS_VENTAS] ) AS QUOTE
FULL OUTER JOIN 
( SELECT DISTINCT T0.[U_ORN_RUTAS_VENTAS] AS "RUTA", T0.[CardName]'NOMBRE',  CASE 
WHEN T1.[GroupCode]=100 THEN 'CADENA SUPERMERCADO'
WHEN T1.[GroupCode]=101 THEN 'MATERIA PRIMA'
WHEN T1.[GroupCode]=102 THEN 'PTES PIEZAS Y REPUES'
WHEN T1.[GroupCode]=103 THEN 'SERVICIOS'
WHEN T1.[GroupCode]=104 THEN 'SERVICIOS PERSONAL'
WHEN T1.[GroupCode]=105 THEN 'SERVICIOS/PIEZAS/REP'
WHEN T1.[GroupCode]=106 THEN 'DISTRIBUIDOR'
WHEN T1.[GroupCode]=107 THEN 'INSTITUCIONAL'
WHEN T1.[GroupCode]=108 THEN 'MAYORISTA'
WHEN T1.[GroupCode]=109 THEN 'RESTAURANT'
WHEN T1.[GroupCode]=110 THEN 'SUPERMERCADO INDEPENDIENTE'
WHEN T1.[GroupCode]=111 THEN 'EMPLEADOS'
WHEN T1.[GroupCode]=112 THEN 'ACCIONISTA'
WHEN T1.[GroupCode]=113 THEN 'ESPECIAL'
WHEN T1.[GroupCode]=114 THEN 'COMIDA/VIVERES'
WHEN T1.[GroupCode]=115 THEN 'ARTICULOS DE OFICINA'
WHEN T1.[GroupCode]=116 THEN 'TRANSPORTE'
END AS 'CATEGORIA'
FROM OINV T0  INNER JOIN OCRD T1 ON T0.[CardCode] = T1.[CardCode] INNER JOIN INV1 T2 ON T0.[DocEntry] = T2.[DocEntry] 
WHERE T0.[DocDate] BETWEEN [%0] AND [%1] AND T2.[Quantity] >0   
GROUP BY T0.[CardName], T1.[GroupCode], T0.[U_ORN_RUTAS_VENTAS] ) AS  INVOICE ON QUOTE.NOMBRE = INVOICE.NOMBRE) AS "TOTAL" GROUP BY TOTAL.RUTA, TOTAL.CATEGORIA
) AS "TOTALACTIVO"



 FULL OUTER JOIN

(

SELECT T0.[U_ORN_RUTAS_VENTAS] as "RUTA",  CASE 
WHEN T0.[GroupCode]=100 THEN 'CADENA SUPERMERCADO'
WHEN T0.[GroupCode]=101 THEN 'MATERIA PRIMA'
WHEN T0.[GroupCode]=102 THEN 'PTES PIEZAS Y REPUES'
WHEN T0.[GroupCode]=103 THEN 'SERVICIOS'
WHEN T0.[GroupCode]=104 THEN 'SERVICIOS PERSONAL'
WHEN T0.[GroupCode]=105 THEN 'SERVICIOS/PIEZAS/REP'
WHEN T0.[GroupCode]=106 THEN 'DISTRIBUIDOR'
WHEN T0.[GroupCode]=107 THEN 'INSTITUCIONAL'
WHEN T0.[GroupCode]=108 THEN 'MAYORISTA'
WHEN T0.[GroupCode]=109 THEN 'RESTAURANT'
WHEN T0.[GroupCode]=110 THEN 'SUPERMERCADO INDEPENDIENTE'
WHEN T0.[GroupCode]=111 THEN 'EMPLEADOS'
WHEN T0.[GroupCode]=112 THEN 'ACCIONISTA'
WHEN T0.[GroupCode]=113 THEN 'ESPECIAL'
WHEN T0.[GroupCode]=114 THEN 'COMIDA/VIVERES'
WHEN T0.[GroupCode]=115 THEN 'ARTICULOS DE OFICINA'
WHEN T0.[GroupCode]=116 THEN 'TRANSPORTE'
END AS 'CATEGORIA', count(T0.[CardName]) as "CLIENTES" FROM OCRD T0 WHERE T0.[U_ORN_RUTAS_VENTAS] is not null AND T0.[GroupCode] not in ('102') AND T0.[GroupCode] not in ('103') AND T0.[GroupCode] not in ('105')   GROUP BY T0.[U_ORN_RUTAS_VENTAS], T0.[GroupCode]
) AS "TOTALCLIENTE" ON TOTALCLIENTE.CATEGORIA = TOTALACTIVO.CATEGORIA AND TOTALCLIENTE.RUTA=TOTALACTIVO.RUTA WHERE TOTALACTIVO.RUTA IS NOT NULL  GROUP BY TOTALACTIVO.CATEGORIA, TOTALCLIENTE.CLIENTES, TOTALACTIVO.ACTIVACION) AS TOTALES GROUP BY  TOTALES.CATEGORIA



